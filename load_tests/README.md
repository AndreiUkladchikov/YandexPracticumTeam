# Тестирование MongoDB

## Запуск шарда MongoDB
- Скопируйте .env.example как .env
- Запустите MongoDB docker compose up -d
- Сконфигурируйте шард, создайте тестовую БД и коллекции, запустив скрипт configure.sh

## Запуск тестов
- создайте виртуальное окружение python, например: pipenv install -r tester/requirements.txt && pipenv shell
- запустите тесты: python tester/main.py

Результат в секундах (max - худший случай, min - лучший случай, avg - среднее время):
- запись одного документа в коллекцию с рейтингом и отзывами пользователей: 
    max: 0.03176689147949219, min: 0.008549213409423828, avg: 0.016848535537719728
- запись одного документа в коллекцию смотреть позже: 
    max: 0.007612943649291992, min: 0.0041658878326416016, avg: 0.0050555777549743655
- количество лайков и дизлайков у определённого фильма: 
    max: 0.002583742141723633, min: 0.0015931129455566406, avg: 0.0018590855598449706
- средняя пользовательская оценка фильма: 
    max: 0.004717588424682617, min: 0.0019390583038330078, avg: 0.0022425770759582518
- добавление лайка: 
    max: 0.011004209518432617, min: 0.006200313568115234, avg: 0.006754658222198486
- добавление дизлайка: 
    max: 0.02285456657409668, min: 0.005187511444091797, avg: 0.011806700229644775
- список понравившихся пользователю фильмов (список лайков пользователя): 
    max: 0.00516200065612793, min: 0.003469228744506836, avg: 0.0037955641746520996
- список фильмов пользователя для просмотра позже: 
    max: 0.0025610923767089844, min: 0.0016536712646484375, avg: 0.0019845652580261232


## Запуск Postgres
load_tests/postgres :
- python create_db.py (создаем таблицу)
- python create_data.py (наполняем фейковыми данными)
- запуск тестов python tests.py

Результат:
Write 1 row in 24.266 ms
Read 1 row in 13.216 ms
Write 1 row in 13.942 ms
Read 1 row in 12.164 ms
Write 1 row in 28.636 ms
Read 1 row in 12.317 ms
Write 1 row in 13.044 ms
Read 1 row in 34.002 ms..

## Выводы
- Оба хранилища показали быструю скорость чтения
- MongoDB поддерживает JSON query, что может очень пригодится при дальнейшнем развитии сервиса
- MongoDB - возможность реплицирования на разных серверах

Выбираем MongoDB в качестве хранилща
